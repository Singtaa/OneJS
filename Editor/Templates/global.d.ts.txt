// OneJS runtime globals (provided by QuickJSBootstrap.js)
// Note: CS.* types are provided by unity-types package

// Root UI element
declare const __root: CS.UnityEngine.UIElements.VisualElement;

// Event API for UI Toolkit elements
declare const __eventAPI: {
    addEventListener: (element: CS.UnityEngine.UIElements.VisualElement, eventType: string, callback: Function) => void;
    removeEventListener: (element: CS.UnityEngine.UIElements.VisualElement, eventType: string, callback: Function) => void;
    removeAllEventListeners: (element: CS.UnityEngine.UIElements.VisualElement) => void;
};

// Get System.Type from a Unity/C# class constructor
// Usage: go.AddComponent($typeof(MeshFilter))
// Note: With improved interop, you can often pass types directly: go.AddComponent(MeshFilter)
declare function $typeof<T>(type: { new(...args: any[]): T } | T): CS.System.Type;

// Extend GameObject.AddComponent to accept constructor types directly
declare namespace CS.UnityEngine {
    interface GameObject {
        AddComponent<T extends CS.UnityEngine.Component>(type: { new(...args: any[]): T }): T;
    }
}

// All C# objects wrapped by OneJS have these handle properties at runtime
// This allows VisualElement to be passed to render() without type errors
declare namespace CS.UnityEngine.UIElements {
    interface VisualElement {
        __csHandle: number;
        __csType: string;
    }
}

// C# object helpers
declare const __csHelpers: {
    newObject: (typeName: string, ...args: unknown[]) => unknown;
    callMethod: (obj: unknown, methodName: string, ...args: unknown[]) => unknown;
    callStatic: (typeName: string, methodName: string, ...args: unknown[]) => unknown;
    wrapObject: (typeName: string, handle: number) => unknown;
    releaseObject: (obj: unknown) => void;
};

// Console (provided by QuickJS)
declare const console: {
    log: (...args: unknown[]) => void;
    error: (...args: unknown[]) => void;
    warn: (...args: unknown[]) => void;
};

// Timers (provided by QuickJSBootstrap.js)
declare function setTimeout(callback: () => void, ms?: number): number;
declare function clearTimeout(id: number): void;
declare function setInterval(callback: () => void, ms?: number): number;
declare function clearInterval(id: number): void;
declare function requestAnimationFrame(callback: (timestamp: number) => void): number;
declare function cancelAnimationFrame(id: number): void;
declare function queueMicrotask(callback: () => void): void;

declare const performance: {
    now: () => number;
};

// StyleSheet API
declare function loadStyleSheet(path: string): boolean;
declare function compileStyleSheet(ussContent: string, name?: string): boolean;
declare function removeStyleSheet(name: string): boolean;
declare function clearStyleSheets(): number;

// ES6 module declarations for Unity namespaces
// Allows: import { GameObject } from "UnityEngine"
declare module "UnityEngine" {
    export = CS.UnityEngine;
}

declare module "UnityEngine/UIElements" {
    export = CS.UnityEngine.UIElements;
}

declare module "System" {
    export = CS.System;
}
